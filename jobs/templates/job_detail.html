{% extends 'base.html' %}
 {% block title %}
    <title>Job for {{ job.title }}</title>
    {% endblock title %}

{% block content %}
    <div class="container justify-content-center m-4">

    <h1>{{ job.title }}</h1>


<div class="container">
<div class="col-7">
    <div class="row justify-content-center">
    
    <div class="card-body mr-5">
<table class="table table-hover table-striped table-bordered col-6" enctype="multipart/form-data" id="dataTable">
   
        <tr>
            <th style="padding:20px 10px">Description</th>
            <td style="padding:20px 10px">{{ job.description }}</td>
        </tr>
           <tr>
            <th style="padding:20px 10px">Company Name</th>
            <td style="padding:20px 10px">{{job.company_name}}</td>
        </tr>
        <tr>
            <th style="padding:20px 10px">Company Website</th>
            <td style="padding:20px 10px"><a>{{job.company_website}} </a></td>

        </tr>
        <tr>
            <th style="padding:20px 10px">Location</th>
            <td style="padding:20px 10px"><a>{{job.location}}</a></td>

        </tr>
        <tr>
            <th style="padding:20px 10px">Salary</th>
            <td style="padding:20px 10px"><a>{{job.salary}}</a></td>

        </tr>
         <tr>
            <th style="padding:20px 10px">Category</th>
            <td style="padding:20px 10px"><a>{{job.category}}</a></td>

        </tr>
            <th style="padding:20px 10px">Posted On</th>
            <td style="padding:20px 10px">{{job.created_at}}</td>

        </tr>
         <tr>
            <th style="padding:20px 10px">Valid Till</th>
            <td style="padding:20px 10px">{{job.application_valid}}</td>

        </tr>

         <tr>
            <th style="padding:20px 10px">Posted By</th>
            <td style="padding:20px 10px">{{job.posted_by}}</td>

        </tr>
        {% if not request.user.is_employer or request.user == job.posted_by  %}

        <tr>
                <th style="padding:20px 10px">Actions</th>
                <td style="padding:20px 10px">
                     {% if not request.user.is_employer %}
                     
                     {% if applications %}
                                
                        <p>You have already applied for this job.</p>
                     {% else %}
                    <a type="submit" class="btn btn-secondary btn-sm" href="{% url 'jobs:apply_job' job.id %}" style="padding:5px 10px"> Apply</a>
                    {% endif %}
                    
    {% endif %}

    {% if request.user == job.posted_by %}

    <a type="submit" class="btn btn-secondary" href="{% url 'jobs:edit_job' job.id %}"><span class="btn-label"><i class="bi bi-pencil"></i></span> Edit Job</a>
    <button data-jobid = "{{job.id}}" class = "btn btn-danger" data-bs-toggle="modal" data-bs-target="#exampleModal"><i class="bi bi-trash"></i> Delete</button>

    {% endif %}
                </td>
            </tr>
    {% endif %}
      
</table>

   
</div>
</div>
</div>
</div>
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
   <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <h1 class="modal-title fs-5" id="exampleModalLabel">Delete Job</h1>
         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
       </div>
       <div class="modal-body">
           Are You Sure?
           <form id="delete-form" method="post" action="{% url 'jobs:delete_job' %}">{%csrf_token%}
                   <input type="text" name="jobid" id="_jobid" />
           </form>
       </div>
       <div class="modal-footer">
         <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
         <button type="button" class="btn btn-danger btn-md" id="delete-button" >Yes</button>
       
   </div>
 </div>
        </div>
                </div>
                </div>
                    
{% endblock %}

{% block script%}
{{ block.super }}
<script type="text/javascript">
   $(document).ready(function(){
       $.ajax({
           url:'/demo-for-ajax/',
           type:'GET',
           dataType: 'json',
           success: function(res){
               console.log(res);
           },
           error: function(res) {
               console.log(res);
           }
       })
       let modal = document.getElementById("exampleModal");
       modal.addEventListener("show.bs.modal",function(evt){
           let btn = evt.relatedTarget;
           let jobid = btn.dataset.jobid;
           $("#_jobid").val(jobid);
       });

       $("#delete-button").click(function(){
           $("#delete-form").submit();
       });
   });

//    function handleurl(url){
//     url=document.getElementById("url")
//     window.open(url)
//    }
</script>
{% endblock script %}