
{% extends 'base.html' %}

     {% block title %}
    <title>My Applications</title>
    {% endblock title %}


{% block content %}
    {% if applications %}
    <div class="container-fluid mt-8 m-5">
    <div class="row ">
    <h1 class="mt-4">My Applications</h1>
        
            {% for application in applications %}
            {% if request.user ==  application.submitted_by %}

        <div class="col-2 card m-2">
                    <div class="card-body">

                    <p class="mb-1">Resume: <a href="{{ application.resume.url }}">View Application </a></p>
                    <p class="mb-1">Submitted For: {{ application.submitted_for }}</p>
                    <p class="mb-1"> Submitted On: {{ application.submitted_on|date:"F d, Y" }}</p>
   <!-- <button data-applicationid = "{{application.id}}" class = "btn btn-danger" data-bs-toggle="modal" data-bs-target="#exampleModal"><i class="fa fa-trash"></i> Delete</button> -->
                   

                {% if application.status == "rejected" %}
                <div>
                    <hr>
                    <p class="mb-1 text-muted text-wrap"> Your application has been rejected.</p>
                    <a href="" class="btn btn-secondary btn-sm "><span class="btnlabel"><i class="bi bi-eye"></i></span>  View Message</a>

                </div>

                {% elif application.status == "accepted" %}
                <div>
                    <hr>
                    <p class="mb-1 text-muted text-wrap">Your applcation has been accepted.</p>
                    <a href="{% url 'users:view_message' application.id %}" class="btn btn-secondary btn-sm "><span class="btnlabel"><i class="bi bi-eye"></i></span> View Message</a>
                </div>
                {% elif application.status == "pending" %}
                <div>
                    <hr>
                    <p class="mb-1 text-muted text-wrap">Your applcation is in pending.</p>
                    
                </div>
                   
                   
                {% endif %}
              </div>
              </div>
            {% endif %}

            {% endfor %}

                    </div>
                   

            

      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
   <div class="modal-dialog">
     <div class="modal-content">
       <div class="modal-header">
         <h1 class="modal-title fs-5" id="exampleModalLabel">Delete Application</h1>
         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
       </div>
       <div class="modal-body">
           Are You Sure?
           <form id="delete-form" method="post" action="{% url 'users:application_delete' %}">{%csrf_token%}
                   <input type="text" name="applicationid" id="_applicationid" />
           </form>
       </div>
       <div class="modal-footer">
         <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
         <button type="button" class="btn btn-danger btn-md" id="delete-button" >Yes</button>
       
   </div>
 </div>
        </div>
                </div>
                </div>
                    

    {% else %}
        <p>You have not applied for any jovs.</p>
    {% endif %}
{% endblock %}

{% block script%}
{{ block.super }}
<script type="text/javascript">
   $(document).ready(function(){
       $.ajax({
           url:'/demo-for-ajax/',
           type:'GET',
           dataType: 'json',
           success: function(res){
               console.log(res);
           },
           error: function(res) {
               console.log(res);
           }
       })
       let modal = document.getElementById("exampleModal");
       modal.addEventListener("show.bs.modal",function(evt){
           let btn = evt.relatedTarget;
           let applicationid = btn.dataset.applicationid;
           $("#_applicationid").val(applicationid);
       });

       $("#delete-button").click(function(){
           $("#delete-form").submit();
       });
   });
</script>
{% endblock script %}


